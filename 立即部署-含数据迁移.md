# 🚀 立即部署到Railway（含数据迁移）

## ✅ 已完成！代码和数据都准备好了

### 📦 已推送到GitHub
- 仓库：https://github.com/weichen0407/ai-news-chat
- 包含所有代码和初始数据

### 📊 将自动迁移的数据
```
✅ 3个用户（包括管理员jerry）
✅ 5个房间（王宝强离婚、虞书欣恋情等）
✅ 17个NPC（完整人设）
✅ 44条历史消息（每个房间最后10条）
✅ 8条房间成员关系
✅ 2条好友关系
```

---

## 🎯 3步即可完成部署

### 步骤1：访问Railway并创建项目

1. 打开：https://railway.app
2. 点击 **"Deploy from GitHub repo"**
3. 选择：**weichen0407/ai-news-chat**
4. 点击 **"Deploy Now"**

### 步骤2：配置环境变量

在Railway控制台：
1. 点击你的服务
2. 点击 **"Variables"** 标签
3. 添加环境变量：

```
DEEPSEEK_API_KEY=sk-da419e3d9ba94926991572267c0c086a
```

可选（建议添加）：
```
SESSION_SECRET=随机字符串（如：abc123xyz789）
```

### 步骤3：生成域名并访问

1. 等待部署完成（3-5分钟）
2. 点击 **"Settings"** → **"Domains"**
3. 点击 **"Generate Domain"**
4. 访问生成的URL！

---

## 📋 部署后立即可用

### 🔐 管理员账号
访问：`https://你的域名.up.railway.app/admin/login`

```
用户名：jerry
密码：123123
```

### 🏠 已有的房间
- 👫 王宝强离婚风波
- 💕 虞书欣恋情曝光
- 🎭 赵露思新剧开播
- 📰 杨超越新歌发布
- 🎬 陈赫《欢乐送》风波

### 🤖 已有的NPC (17个)
- 王宝强、马蓉、宋喆（离婚风波）
- 虞书欣、赵露思（恋情）
- 记者、粉丝等

### 💬 历史对话
每个房间都有最后10条消息，可以看到完整的对话背景

---

## 🎉 自动数据导入

### 启动时会发生什么

```
1. Railway启动应用
   ↓
2. 创建SQLite数据库
   ↓
3. 检测数据库为空
   ↓
4. 自动读取 initial-data.json
   ↓
5. 导入所有数据（用户、房间、NPC、消息等）
   ↓
6. 应用启动完成
   ↓
7. 访问时看到完整的数据！
```

### 启动日志示例

在Railway的Logs标签，你会看到：

```
🚀 开始初始化...
✅ API密钥格式验证通过
💾 数据库路径: /app/data/app.db
✅ 数据库连接成功

📥 检查是否需要导入初始数据...
   📂 读取初始数据文件...
   🔄 开始导入数据...
      ✅ 导入了 3 个用户
      ✅ 导入了 5 个房间
      ✅ 导入了 17 个NPC
      ✅ 导入了 44 条消息
      ✅ 导入了 8 条成员关系
   ✅ 初始数据导入完成！

✅ 所有检查通过，启动Nuxt应用...
Listening on http://0.0.0.0:3000
```

---

## ✅ 验证部署成功

访问你的Railway URL后，检查：

### 1. 首页
- [ ] 可以访问登录/注册页面
- [ ] 页面样式正常

### 2. 登录测试
- [ ] 用jerry/123123可以登录
- [ ] 登录后看到房间列表

### 3. 房间测试
- [ ] 看到5个预设房间
- [ ] 进入房间看到历史消息（最后10条）
- [ ] 房间内有NPC

### 4. AI对话测试
- [ ] 发送消息
- [ ] NPC自动回复
- [ ] 对话流畅

### 5. 管理后台
- [ ] 访问 /admin/login
- [ ] jerry/123123登录
- [ ] 看到实时监控面板
- [ ] 看到所有房间和NPC

---

## 🎮 部署后可以做什么

### 立即可用的功能

✅ **用户系统**
- 3个现有用户可以登录
- 新用户可以注册

✅ **聊天功能**
- 5个热门话题房间
- 17个NPC自动回复
- AI智能对话

✅ **管理后台**
- 智能控制面板
- Token使用监控
- 房间自动化
- 房间自动发言（新功能！）

✅ **朋友圈系统**
- 发朋友圈
- 点赞评论
- AI自动互动

---

## 💡 重要提示

### ⚠️ 必须设置环境变量

如果不设置 `DEEPSEEK_API_KEY`，应用会报错：
```
❌ 致命错误: DEEPSEEK_API_KEY 环境变量未设置！
```

### 💾 数据持久化

**好消息**：Railway会自动持久化数据！

- 首次部署会导入初始数据
- 之后的部署会保留现有数据
- 新增的用户、消息、朋友圈都会保存
- 重新部署不会丢失数据

### 💰 费用

- 免费额度：$5（约180小时）
- 建议升级：Hobby计划$5/月
- 按实际使用量计费

---

## 🔧 常见问题

### Q1: 部署后看不到数据？

**检查日志**：
- Railway → Deployments → 点击最新部署
- 查看是否有"导入数据"的日志
- 确认是否显示"导入了 X 个用户"

**可能原因**：
- 构建还在进行中（等待3-5分钟）
- 数据库初始化失败（查看错误日志）

### Q2: 登录显示用户不存在？

**解决方法**：
- 确认数据导入成功（查看启动日志）
- 尝试注册新账号测试
- 检查数据库是否正常创建

### Q3: 如何更新初始数据？

**方法**：
1. 本地运行 `node export-data.mjs`
2. 提交新的 `initial-data.json`
3. 推送到GitHub
4. Railway自动重新部署

**注意**：只对新建的数据库有效，现有数据库不会重新导入

### Q4: 如何重置数据？

**方法**：
1. 在Railway删除服务的Volume（数据卷）
2. 重新部署
3. 应用会重新导入初始数据

---

## 📊 与之前的区别

### 之前的部署
```
❌ 空数据库
❌ 需要手动创建房间
❌ 需要手动添加NPC
❌ 没有历史对话
❌ 没有测试账号
```

### 现在的部署
```
✅ 自动导入所有数据
✅ 5个预设房间立即可用
✅ 17个NPC完整人设
✅ 44条历史对话展示效果
✅ 3个测试账号（含管理员）
✅ 完整的演示效果
```

---

## 🎊 准备好了！

所有数据已准备就绪，现在就可以部署了！

### 立即开始

1. 打开：https://railway.app
2. 连接：weichen0407/ai-news-chat
3. 配置：添加DEEPSEEK_API_KEY
4. 等待：3-5分钟部署完成
5. 访问：你的应用！

**部署后立即就能看到完整的数据和功能！🚀**

---

## 📞 获取帮助

### 相关文档
- `数据迁移说明.md` - 详细的数据迁移机制
- `立即部署.md` - 基础部署指南
- `RAILWAY部署步骤.md` - 完整部署文档

### 需要支持
- Railway文档：https://docs.railway.app
- Railway Discord：https://discord.gg/railway

---

**祝部署顺利！一切数据都已准备好！🎉**

