# 💬 AI聊天模拟器 - 多人在线版

一个基于 Nuxt 3 和 DeepSeek API 的多人在线AI聊天模拟器，支持创建剧情房间、自定义NPC角色，与其他玩家一起进行角色扮演对话。

## ✨ 核心功能

### 🎮 多人在线系统
- 👤 **用户注册登录**：完整的认证系统，Session管理
- 🏠 **房间系统**：创建/加入/管理群聊房间
- 👥 **多人互动**：多个玩家在同一房间实时互动
- 📊 **三Tab界面**：我的群聊、我创建的、个人中心

### 🎭 角色扮演系统
- 🤖 **NPC角色**：每个房间可设置多个AI控制的NPC
- 🎯 **自定义人设**：为NPC和自己设置详细的人物设定
- 🖼️ **头像系统**：支持上传真实图片作为头像
- 💬 **智能回复**：NPC根据聊天内容智能决定是否回复

### 🎨 创作者工具
- ✍️ **剧情编辑器**：群主可以创建完整的剧情背景
- 👥 **NPC管理**：添加、编辑NPC角色和人设
- 🔧 **房间设置**：查看成员、管理房间信息
- 🆔 **分享功能**：生成房间ID，邀请其他玩家加入

### 💬 聊天体验
- ⌨️ **命令驱动**：通过指令控制自己的角色行为
- ✨ **AI生成**：AI根据指令生成符合角色人设的对话
- 📝 **消息编辑**：生成后可以编辑再发送
- 💚 **微信风格**：完美还原微信聊天UI
- 💾 **消息持久化**：所有聊天记录保存在数据库

## 🚀 快速开始

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

服务器将在 `http://0.0.0.0:3001` 启动。

### 构建生产版本

```bash
npm run build
npm run preview
```

## 📖 使用说明

### 1. 注册/登录

访问 `http://localhost:3001/login` 注册新账号或登录。

### 2. 创建群聊

1. 点击右上角"➕ 创建群聊"
2. 填写基本信息：
   - 群聊名称
   - 群聊描述
   - 事件背景（剧情设定）
3. 添加NPC角色：
   - 上传NPC头像
   - 设置角色名称和人设
   - 可添加多个NPC（最多10个）
4. 点击"创建群聊"，系统会生成一个6位房间ID

### 3. 加入群聊

1. 点击"🔍 加入群聊"
2. 输入6位房间ID
3. （可选）设置你的角色名称和人设
4. 点击"加入"

### 4. 开始对话

1. 进入群聊后，在底部输入指令
   - 例如："骂马蓉"、"安慰王宝强"、"质问宋喆"
2. 点击"✨ 生成"，AI会生成符合你角色的对话
3. 观看打字效果（可以在生成过程中修改）
4. 点击"📤 发送"
5. NPC会智能判断是否回复你的消息

### 5. 管理房间（群主）

群主可以：
- 查看所有成员列表
- 查看NPC配置
- 复制房间ID分享
- 查看房间统计信息

## 🎯 使用示例

### 王宝强事件群聊

**事件背景：**
2016年8月，王宝强发现妻子马蓉与经纪人宋喆出轨，随后发布离婚声明。此事件涉及9套房产、多家公司股权以及孩子抚养权等问题。

**NPC设置：**
1. 王宝强 - 受害者，愤怒且伤心，想要维护权益
2. 马蓉 - 出轨方，试图辩解和转移财产
3. 宋喆 - 第三者，心虚且试图推卸责任

**你的角色：** 嘴臭的记者

**指令示例：**
- "质问马蓉为什么出轨"
- "安慰王宝强要坚强"
- "调侃宋喆是小三"
- "采访王宝强的感受"

## 🏗️ 技术架构

### 前端
- **框架**: Nuxt 3
- **UI**: Vue 3 Composition API
- **样式**: 原生CSS（微信风格）

### 后端
- **运行时**: Nitro（Nuxt服务端）
- **数据库**: SQLite（开发）/ PostgreSQL（生产）
- **认证**: Cookie-based Session
- **API**: RESTful API

### AI
- **模型**: DeepSeek Chat
- **功能**: 
  - 根据指令生成角色对话
  - 智能判断NPC回复
  - 打字效果模拟

## 📊 数据库结构

- `users` - 用户表
- `rooms` - 房间表
- `npcs` - NPC角色表
- `room_members` - 房间成员表
- `messages` - 消息表
- `sessions` - Session表

## 🌐 部署

### Railway（推荐）

```bash
railway login
railway init
railway variables set DEEPSEEK_API_KEY=your_key
railway up
```

### Vercel

```bash
vercel login
vercel
vercel env add DEEPSEEK_API_KEY
```

详细部署指南请查看 [DEPLOYMENT.md](./DEPLOYMENT.md)

## 🔧 环境变量

创建 `.env` 文件：

```env
DEEPSEEK_API_KEY=sk-da419e3d9ba94926991572267c0c086a
```

## 📁 项目结构

```
AI-news/
├── pages/
│   ├── index.vue           # 主页（3个Tab）
│   ├── login.vue           # 登录/注册页
│   └── room/
│       └── [id].vue        # 聊天室页面
├── components/
│   ├── CreateRoomForm.vue  # 创建房间表单
│   └── RoomSettings.vue    # 房间设置
├── server/
│   ├── api/
│   │   ├── auth/          # 认证API
│   │   ├── rooms/         # 房间API
│   │   └── messages/      # 消息API
│   └── utils/
│       ├── db.ts          # 数据库工具
│       └── auth.ts        # 认证工具
├── middleware/
│   └── auth.ts            # 认证中间件
├── data/                  # SQLite数据库文件
└── public/
    └── avatars/           # 默认头像
```

## 🎨 界面特色

- 💬 微信风格聊天界面
- 📱 响应式设计
- 🖼️ 圆形头像显示
- 💚 绿色消息气泡（自己）
- ⚪ 白色消息气泡（其他人）
- ⌨️ 打字动画效果
- 💭 "正在输入..."提示
- ⏰ 消息时间显示
- ✨ 流畅的动画效果

## 🔐 安全性

- 密码SHA-256加密
- Session安全管理
- SQL注入防护
- XSS防护
- CSRF防护（Cookie SameSite）

## 🚧 已知限制

- SQLite不适合生产环境高并发
- 建议部署时使用PostgreSQL
- 图片以Base64存储，建议使用对象存储
- 暂无实时WebSocket，需手动刷新获取新消息

## 📝 待优化

- [ ] WebSocket实时通信
- [ ] 图片上传到对象存储
- [ ] 消息撤回功能
- [ ] @提及功能
- [ ] 表情包支持
- [ ] 语音消息
- [ ] 房间搜索功能
- [ ] 用户黑名单
- [ ] 群主转让

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 📄 许可

MIT License

---

Made with ❤️ using Nuxt 3 and DeepSeek API
