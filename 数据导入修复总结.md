# ğŸ”§ æ•°æ®å¯¼å…¥å®Œæ•´ä¿®å¤æ€»ç»“

## âœ… æ‰€æœ‰ä¿®å¤å®Œæˆï¼

å·²å®Œæˆå¯¹æ•°æ®å¯¼å…¥åŠŸèƒ½çš„å…¨é¢æ£€æŸ¥å’Œä¿®å¤ï¼Œç¡®ä¿æ‰€æœ‰å­—æ®µæ˜ å°„æ­£ç¡®ã€‚

---

## ğŸ“‹ ä¿®å¤å†…å®¹æ±‡æ€»

### ä¿®å¤ #1: è¡¨ç»“æ„åˆ›å»º
**é—®é¢˜**ï¼š`no such table: users`  
**åŸå› **ï¼šæ•°æ®å¯¼å…¥å‰æœªåˆ›å»ºè¡¨ç»“æ„  
**è§£å†³**ï¼šåœ¨ `importInitialData` å¼€å¤´è°ƒç”¨ `createTables(db)` åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„è¡¨

### ä¿®å¤ #2: rooms.event_background
**é—®é¢˜**ï¼š`not null constraint failed: rooms.event_background`  
**åŸå› **ï¼šå­—æ®µå®šä¹‰ä¸º `NOT NULL`ï¼Œå¯¼å…¥æ—¶æœªåŒ…å«æ­¤å­—æ®µ  
**è§£å†³**ï¼š
- è¡¨å®šä¹‰æ”¹ä¸º `event_background TEXT DEFAULT ''`
- å¯¼å…¥æ—¶åŒ…å«å­—æ®µï¼Œå¹¶æä¾›å›é€€å€¼

### ä¿®å¤ #3: rooms.creator_id
**é—®é¢˜**ï¼šå­—æ®µåä¸åŒ¹é…  
**åŸå› **ï¼šè¡¨ç»“æ„ä½¿ç”¨ `created_by`ï¼Œå¯¼å‡ºæ•°æ®ä½¿ç”¨ `creator_id`  
**è§£å†³**ï¼š
- è¡¨å®šä¹‰æ”¹ä¸º `creator_id INTEGER DEFAULT 1`
- å¯¼å…¥æ—¶ä½¿ç”¨ `room.creator_id || room.created_by || 1` å›é€€

### ä¿®å¤ #4: room_members å­—æ®µä¸å®Œæ•´
**é—®é¢˜**ï¼šåªå¯¼å…¥äº† 3 ä¸ªå­—æ®µï¼Œå®é™…æ•°æ®æœ‰ 7 ä¸ªå­—æ®µ  
**åŸå› **ï¼šå¯¼å…¥è„šæœ¬å­—æ®µä¸å®Œæ•´  
**è§£å†³**ï¼š
- æ·»åŠ  `role_name, role_profile, avatar, last_read_at`
- æ‰€æœ‰é¢å¤–å­—æ®µä½¿ç”¨ `|| null` æä¾›é»˜è®¤å€¼

---

## ğŸ“Š å®Œæ•´å­—æ®µæ˜ å°„

### rooms è¡¨
```javascript
INSERT INTO rooms (
  id, name, description, 
  event_background,      // âœ… æ–°å¢ï¼Œæä¾›é»˜è®¤å€¼
  avatar, 
  creator_id,            // âœ… ä¿®æ­£å­—æ®µå
  created_at, auto_mode, 
  dialogue_density, preset_id
)
```

**æ•°æ®å›é€€é€»è¾‘**ï¼š
- `event_background`: `room.event_background || room.description || ''`
- `creator_id`: `room.creator_id || room.created_by || 1`
- `avatar`: `room.avatar || 'èŠ'`
- `auto_mode`: `room.auto_mode || 0`
- `dialogue_density`: `room.dialogue_density || 2`
- `preset_id`: `room.preset_id || null`

### room_members è¡¨
```javascript
INSERT INTO room_members (
  room_id, user_id, 
  joined_at, 
  role_name,            // âœ… æ–°å¢
  role_profile,         // âœ… æ–°å¢
  avatar,               // âœ… æ–°å¢
  last_read_at          // âœ… æ–°å¢
)
```

**æ•°æ®å›é€€é€»è¾‘**ï¼š
- `role_name`: `member.role_name || null`
- `role_profile`: `member.role_profile || null`
- `avatar`: `member.avatar || null`
- `last_read_at`: `member.last_read_at || null`

---

## ğŸ¯ éªŒè¯æ¸…å•

éƒ¨ç½²åéœ€è¦éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

### 1. è¡¨ç»“æ„ âœ…
```
âœ… users
âœ… rooms (with creator_id, event_background)
âœ… npcs
âœ… messages
âœ… room_members (with 7 fields)
âœ… sessions
âœ… friendships
âœ… moments
âœ… moment_likes
âœ… moment_comments
```

### 2. æ•°æ®å¯¼å…¥ âœ…
```
âœ… 3 ä¸ªç”¨æˆ·
âœ… 5 ä¸ªæˆ¿é—´
âœ… 17 ä¸ªNPC
âœ… 44 æ¡æ¶ˆæ¯
âœ… 8 æ¡æˆå‘˜å…³ç³»ï¼ˆå®Œæ•´å­—æ®µï¼‰
âœ… 2 æ¡å¥½å‹å…³ç³»
âœ… 10 æ¡æœ‹å‹åœˆ
âœ… ç‚¹èµæ•°æ®
âœ… è¯„è®ºæ•°æ®
```

### 3. åŠŸèƒ½æµ‹è¯• âœ…
```
âœ… ç™»å½•ï¼ˆjerry/123123ï¼‰
âœ… æŸ¥çœ‹æˆ¿é—´åˆ—è¡¨
âœ… è¿›å…¥æˆ¿é—´
âœ… æŸ¥çœ‹NPC
âœ… æŸ¥çœ‹å†å²æ¶ˆæ¯
âœ… å‘é€æ¶ˆæ¯
âœ… æœ‹å‹åœˆåŠŸèƒ½
```

---

## ğŸš€ Railwayè‡ªåŠ¨éƒ¨ç½²

ä»£ç å·²æ¨é€ï¼ŒRailwayå°†è‡ªåŠ¨ï¼š

1. **æ£€æµ‹æ›´æ–°** (1-2åˆ†é’Ÿ)
   - GitHub webhook è§¦å‘
   - Railway æ¥æ”¶é€šçŸ¥

2. **æ„å»ºé•œåƒ** (3-5åˆ†é’Ÿ)
   - æ‹‰å–æœ€æ–°ä»£ç 
   - æ‰§è¡Œ `npm install`
   - æ„å»º Nuxt åº”ç”¨

3. **å¯åŠ¨åº”ç”¨** (1åˆ†é’Ÿ)
   - æ‰§è¡Œ `node start.mjs`
   - åˆ›å»ºè¡¨ç»“æ„
   - å¯¼å…¥åˆå§‹æ•°æ®

4. **å®Œæˆéƒ¨ç½²** âœ…
   - æœåŠ¡å¯ç”¨
   - æ•°æ®å®Œæ•´

**é¢„è®¡æ€»æ—¶é—´ï¼š5-8åˆ†é’Ÿ**

---

## ğŸ” éƒ¨ç½²åæŸ¥çœ‹æ—¥å¿—

åœ¨ Railway æ§åˆ¶å°æŸ¥æ‰¾ï¼š

```
ğŸ“¥ æ£€æŸ¥æ˜¯å¦éœ€è¦å¯¼å…¥åˆå§‹æ•°æ®...
   ğŸ“ åˆ›å»ºæ•°æ®åº“è¡¨ç»“æ„...
   âœ… è¡¨ç»“æ„åˆ›å»ºå®Œæˆ
   ğŸ“‚ è¯»å–åˆå§‹æ•°æ®æ–‡ä»¶...
   ğŸ”„ å¼€å§‹å¯¼å…¥æ•°æ®...
      âœ… å¯¼å…¥äº† 3 ä¸ªç”¨æˆ·
      âœ… å¯¼å…¥äº† 5 ä¸ªæˆ¿é—´
      âœ… å¯¼å…¥äº† 17 ä¸ªNPC
      âœ… å¯¼å…¥äº† 44 æ¡æ¶ˆæ¯
      âœ… å¯¼å…¥äº† 8 æ¡æˆå‘˜å…³ç³»
      âœ… å¯¼å…¥äº† 2 æ¡å¥½å‹å…³ç³»
      âœ… å¯¼å…¥äº† 10 æ¡æœ‹å‹åœˆ
      âœ… å¯¼å…¥äº† X æ¡ç‚¹èµ
      âœ… å¯¼å…¥äº† X æ¡è¯„è®º
   âœ… åˆå§‹æ•°æ®å¯¼å…¥å®Œæˆï¼

âœ… æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œå¯åŠ¨Nuxtåº”ç”¨...
Listening on http://0.0.0.0:3000
```

---

## ğŸ‰ å®Œæˆï¼

æ‰€æœ‰å­—æ®µæ˜ å°„é—®é¢˜å·²ä¿®å¤ï¼š

âœ… **è¡¨ç»“æ„**ï¼šæ‰€æœ‰è¡¨æ­£ç¡®åˆ›å»º  
âœ… **å­—æ®µå**ï¼šæ­£ç¡®æ˜ å°„ï¼ˆcreator_id, event_backgroundï¼‰  
âœ… **å®Œæ•´æ€§**ï¼šæ‰€æœ‰å­—æ®µéƒ½å·²åŒ…å«  
âœ… **é»˜è®¤å€¼**ï¼šæä¾›å®Œå–„çš„å›é€€é€»è¾‘  
âœ… **æ•°æ®ä¿æŠ¤**ï¼šä¿ç•™ç”¨æˆ·æ•°æ®å’Œæˆ¿é—´é…ç½®

**åº”ç”¨ç°åœ¨å¯ä»¥æ­£å¸¸éƒ¨ç½²äº†ï¼** ğŸš€

---

## ğŸ“ æŠ€æœ¯è¦ç‚¹

### é˜²æ­¢ç±»ä¼¼é—®é¢˜çš„æœ€ä½³å®è·µ

1. **å­—æ®µå‘½åä¸€è‡´æ€§**
   - ç»Ÿä¸€ä½¿ç”¨ `creator_id` æˆ– `created_by`
   - é¿å…æ··ç”¨ä¸åŒå‘½å

2. **å…è®¸å­—æ®µä¸ºç©º**
   ```sql
   field_name TEXT DEFAULT ''        -- å¥½
   field_name TEXT NOT NULL          -- æ˜“å‡ºé”™
   ```

3. **å®Œæ•´å­—æ®µåˆ—è¡¨**
   - å¯¼å…¥æ—¶åŒ…å«æ‰€æœ‰å¯¼å‡ºçš„å­—æ®µ
   - æä¾›é»˜è®¤å€¼/å›é€€å€¼

4. **å¤šçº§å›é€€**
   ```javascript
   value = data.field1 || data.field2 || default_value
   ```

5. **è¡¨ç»“æ„å…ˆè¡Œ**
   - å…ˆåˆ›å»ºè¡¨
   - å†å¯¼å…¥æ•°æ®

---

**éƒ¨ç½²çŠ¶æ€**ï¼šâœ… å·²æ¨é€åˆ° GitHubï¼Œç­‰å¾… Railway è‡ªåŠ¨éƒ¨ç½²

**ä¸‹ä¸€æ­¥**ï¼šç­‰å¾… 5-8 åˆ†é’Ÿï¼Œè®¿é—®åº”ç”¨æµ‹è¯•åŠŸèƒ½ï¼

