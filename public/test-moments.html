<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æœ‹å‹åœˆåŠŸèƒ½æµ‹è¯•</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: #f5f5f5;
      }
      h1 {
        color: #333;
        border-bottom: 3px solid #07c160;
        padding-bottom: 0.5rem;
      }
      h2 {
        color: #555;
        margin-top: 2rem;
      }
      .test-section {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .btn {
        background: #07c160;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .btn:hover {
        background: #06ad56;
      }
      .btn-secondary {
        background: #576b95;
      }
      .btn-secondary:hover {
        background: #485a7e;
      }
      .result {
        background: #f7f7f7;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 1rem;
        margin-top: 1rem;
        white-space: pre-wrap;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        max-height: 300px;
        overflow-y: auto;
      }
      .success {
        border-left: 4px solid #07c160;
        background: #f0fdf4;
      }
      .error {
        border-left: 4px solid #ef4444;
        background: #fef2f2;
      }
      .input-group {
        margin: 1rem 0;
      }
      label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #555;
      }
      input,
      textarea {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        font-size: 1rem;
        font-family: inherit;
      }
      textarea {
        resize: vertical;
        min-height: 100px;
      }
      .status-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.85rem;
        font-weight: 600;
      }
      .status-pending {
        background: #fef3c7;
        color: #92400e;
      }
      .status-success {
        background: #d1fae5;
        color: #065f46;
      }
      .status-error {
        background: #fee2e2;
        color: #991b1b;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ‰ æœ‹å‹åœˆåŠŸèƒ½æµ‹è¯•å·¥å…·</h1>

    <!-- Step 1: åˆå§‹åŒ– -->
    <div class="test-section">
      <h2>Step 1: åˆå§‹åŒ–æ•°æ®åº“è¡¨</h2>
      <p>é¦–æ¬¡ä½¿ç”¨æœ‹å‹åœˆåŠŸèƒ½å‰ï¼Œéœ€è¦åˆå§‹åŒ–æ•°æ®åº“è¡¨</p>
      <button onclick="initTables()" class="btn">ğŸš€ åˆå§‹åŒ–æ•°æ®è¡¨</button>
      <div id="init-result"></div>
    </div>

    <!-- Step 2: åˆ›å»ºæœ‹å‹åœˆ -->
    <div class="test-section">
      <h2>Step 2: åˆ›å»ºæœ‹å‹åœˆï¼ˆç©å®¶å‘å¸ƒï¼‰</h2>
      <div class="input-group">
        <label>æˆ¿é—´ID:</label>
        <input id="create-room-id" type="text" value="ROOM123" />
      </div>
      <div class="input-group">
        <label>ç”¨æˆ·ID:</label>
        <input id="create-user-id" type="number" value="1" />
      </div>
      <div class="input-group">
        <label>æœ‹å‹åœˆå†…å®¹:</label>
        <textarea id="create-content">ä»Šå¤©å¤©æ°”çœŸå¥½ï¼â˜€ï¸</textarea>
      </div>
      <button onclick="createMoment()" class="btn">ğŸ“ å‘å¸ƒæœ‹å‹åœˆ</button>
      <div id="create-result"></div>
    </div>

    <!-- Step 3: è·å–æœ‹å‹åœˆåˆ—è¡¨ -->
    <div class="test-section">
      <h2>Step 3: è·å–æœ‹å‹åœˆåˆ—è¡¨</h2>
      <div class="input-group">
        <label>æˆ¿é—´ID:</label>
        <input id="list-room-id" type="text" value="ROOM123" />
      </div>
      <button onclick="getMoments()" class="btn">ğŸ“‹ è·å–åˆ—è¡¨</button>
      <div id="list-result"></div>
    </div>

    <!-- Step 4: AIç”Ÿæˆ -->
    <div class="test-section">
      <h2>Step 4: AIç”Ÿæˆæœ‹å‹åœˆ</h2>
      <div class="input-group">
        <label>æˆ¿é—´ID:</label>
        <input id="ai-room-id" type="text" value="ROOM123" />
      </div>
      <div class="input-group">
        <label>NPC ID:</label>
        <input id="ai-npc-id" type="number" value="1" />
      </div>
      <button onclick="aiGenerate()" class="btn btn-secondary">
        ğŸ¤– AIç”Ÿæˆæœ‹å‹åœˆ
      </button>
      <div id="ai-result"></div>
    </div>

    <!-- Step 5: ç‚¹èµ -->
    <div class="test-section">
      <h2>Step 5: ç‚¹èµåŠŸèƒ½</h2>
      <div class="input-group">
        <label>æœ‹å‹åœˆID:</label>
        <input id="like-moment-id" type="number" value="1" />
      </div>
      <div class="input-group">
        <label>ç”¨æˆ·ID:</label>
        <input id="like-user-id" type="number" value="1" />
      </div>
      <button onclick="toggleLike()" class="btn">â¤ï¸ ç‚¹èµ/å–æ¶ˆ</button>
      <div id="like-result"></div>
    </div>

    <!-- Step 6: è¯„è®º -->
    <div class="test-section">
      <h2>Step 6: è¯„è®ºåŠŸèƒ½</h2>
      <div class="input-group">
        <label>æœ‹å‹åœˆID:</label>
        <input id="comment-moment-id" type="number" value="1" />
      </div>
      <div class="input-group">
        <label>ç”¨æˆ·ID:</label>
        <input id="comment-user-id" type="number" value="1" />
      </div>
      <div class="input-group">
        <label>è¯„è®ºå†…å®¹:</label>
        <textarea id="comment-content">ç¡®å®æ˜¯ä¸ªå¥½å¤©æ°”ï¼</textarea>
      </div>
      <button onclick="addComment()" class="btn">ğŸ’¬ å‘è¡¨è¯„è®º</button>
      <div id="comment-result"></div>
    </div>

    <!-- å¿«é€Ÿè®¿é—® -->
    <div class="test-section">
      <h2>ğŸ”— å¿«é€Ÿè®¿é—®</h2>
      <button
        onclick="window.open('/room/ROOM123/moments', '_blank')"
        class="btn btn-secondary"
      >
        ğŸ“± æ‰“å¼€æœ‹å‹åœˆé¡µé¢
      </button>
      <button
        onclick="window.location.reload()"
        class="btn btn-secondary"
      >
        ğŸ”„ åˆ·æ–°é¡µé¢
      </button>
    </div>

    <script>
      function showResult(elementId, data, isSuccess = true) {
        const el = document.getElementById(elementId);
        el.className = isSuccess ? "result success" : "result error";
        el.textContent = JSON.stringify(data, null, 2);
      }

      async function initTables() {
        try {
          const response = await fetch("/api/moments/init", {
            method: "POST",
          });
          const data = await response.json();
          showResult("init-result", data, data.success);
        } catch (error) {
          showResult("init-result", { error: error.message }, false);
        }
      }

      async function createMoment() {
        try {
          const roomId = document.getElementById("create-room-id").value;
          const userId = parseInt(
            document.getElementById("create-user-id").value
          );
          const content = document.getElementById("create-content").value;

          const response = await fetch("/api/moments/create", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              room_id: roomId,
              user_id: userId,
              content,
            }),
          });
          const data = await response.json();
          showResult("create-result", data, data.success);
        } catch (error) {
          showResult("create-result", { error: error.message }, false);
        }
      }

      async function getMoments() {
        try {
          const roomId = document.getElementById("list-room-id").value;
          const response = await fetch(`/api/moments/${roomId}/list`);
          const data = await response.json();
          showResult("list-result", data, data.success);
        } catch (error) {
          showResult("list-result", { error: error.message }, false);
        }
      }

      async function aiGenerate() {
        try {
          const roomId = document.getElementById("ai-room-id").value;
          const npcId = parseInt(document.getElementById("ai-npc-id").value);

          const response = await fetch("/api/moments/ai-generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              room_id: roomId,
              npc_id: npcId,
            }),
          });
          const data = await response.json();
          showResult("ai-result", data, data.success);
        } catch (error) {
          showResult("ai-result", { error: error.message }, false);
        }
      }

      async function toggleLike() {
        try {
          const momentId = parseInt(
            document.getElementById("like-moment-id").value
          );
          const userId = parseInt(
            document.getElementById("like-user-id").value
          );

          const response = await fetch("/api/moments/like", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              moment_id: momentId,
              user_id: userId,
            }),
          });
          const data = await response.json();
          showResult("like-result", data, data.success);
        } catch (error) {
          showResult("like-result", { error: error.message }, false);
        }
      }

      async function addComment() {
        try {
          const momentId = parseInt(
            document.getElementById("comment-moment-id").value
          );
          const userId = parseInt(
            document.getElementById("comment-user-id").value
          );
          const content = document.getElementById("comment-content").value;

          const response = await fetch("/api/moments/comment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              moment_id: momentId,
              user_id: userId,
              content,
            }),
          });
          const data = await response.json();
          showResult("comment-result", data, data.success);
        } catch (error) {
          showResult("comment-result", { error: error.message }, false);
        }
      }

      console.log("ğŸ‰ æœ‹å‹åœˆæµ‹è¯•å·¥å…·å·²åŠ è½½");
      console.log("ğŸ’¡ æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—");
    </script>
  </body>
</html>

