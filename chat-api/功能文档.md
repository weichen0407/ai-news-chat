# Chat-API 功能文档

## 📋 产品概述

**Chat-API** 是一个独立的剧情和NPC创作工具，用于创建、管理和导出游戏角色和剧情设定。提供可视化Web界面和RESTful API接口，支持多场景应用。

---

## 🎯 核心功能

### 1. 剧情管理

#### 1.1 创建剧情
- 输入剧情名称、描述
- 设置剧情背景故事（event_background）
- 设置对话密度（1-5级）
- 选择剧情头像（Emoji或图片）

#### 1.2 查看剧情
- 列表展示所有剧情
- 显示剧情基本信息和统计数据
- 支持搜索和筛选

#### 1.3 编辑剧情
- 修改剧情信息
- 更新剧情背景
- 调整对话密度

#### 1.4 删除剧情
- 删除剧情及关联的所有NPC
- 二次确认防止误删

---

### 2. NPC角色管理

#### 2.1 创建NPC
每个NPC包含以下属性：
- **基础信息**：姓名、年龄、职业、头像
- **简介**：角色简要描述（profile）
- **性格特点**：personality
- **技能专长**：skills
- **生活习惯**：habits
- **喜好**：likes
- **厌恶**：dislikes
- **背景故事**：background
- **目标追求**：goals
- **内心恐惧**：fears

#### 2.2 查看NPC
- 卡片式展示
- 显示所有属性
- 按剧情分组

#### 2.3 编辑NPC
- 修改任意属性
- 实时更新

#### 2.4 删除NPC
- 单个删除
- 确认后删除

---

### 3. 数据导出

#### 3.1 导出格式
导出JSON格式，包含：
```json
{
  "story": {
    "id": "房间ID",
    "name": "剧情名称",
    "description": "剧情描述",
    "event_background": "背景故事",
    "dialogue_density": 3,
    "avatar": "🎭"
  },
  "npcs": [
    {
      "name": "角色名",
      "age": 30,
      "occupation": "职业",
      "personality": "性格",
      // ... 其他10项属性
    }
  ]
}
```

#### 3.2 用途
- 导入到主应用
- 备份数据
- 跨平台迁移

---

### 4. 统计功能

实时显示：
- 剧情总数
- NPC总数

---

## 🔌 API接口

### 剧情接口

| 方法 | 路径 | 功能 |
|------|------|------|
| GET | `/api/stories` | 获取所有剧情 |
| POST | `/api/stories` | 创建剧情 |
| GET | `/api/stories/:id` | 获取单个剧情 |
| PUT | `/api/stories/:id` | 更新剧情 |
| DELETE | `/api/stories/:id` | 删除剧情 |
| GET | `/api/stories/:id/export` | 导出剧情和NPC |

### NPC接口

| 方法 | 路径 | 功能 |
|------|------|------|
| GET | `/api/npcs/:storyId` | 获取剧情的所有NPC |
| POST | `/api/npcs` | 创建NPC |
| PUT | `/api/npcs/:id` | 更新NPC |
| DELETE | `/api/npcs/:id` | 删除NPC |

### 统计接口

| 方法 | 路径 | 功能 |
|------|------|------|
| GET | `/api/stats` | 获取统计数据 |

---

## 💾 数据存储

- **数据库**：SQLite
- **存储位置**：`db/stories.db`
- **表结构**：
  - `stories`：剧情表
  - `npcs`：NPC表（关联story_id）

---

## 🎨 用户界面

### 主界面
- 顶部导航：统计卡片
- 剧情区域：展示所有剧情
- NPC区域：展示选中剧情的NPC
- 操作按钮：创建、编辑、删除、导出

### 交互特点
- 单页应用，无需刷新
- 模态框表单
- 实时更新
- 响应式设计

---

## 🚀 使用场景

### 场景1：游戏开发
为游戏创建NPC和剧情设定，导出后集成到游戏中

### 场景2：AI对话系统
创建角色人设，用于AI角色扮演对话

### 场景3：剧本创作
编剧使用工具管理角色和剧情线索

### 场景4：教育培训
创建案例角色，用于商业、心理学等课程讨论

---

## 📦 预设内容

### 已包含11个精品剧情：
1. ⚗️ 绝命毒师：白先生的帝国
2. 👑 甄嬛传：后宫风云
3. 🏀 NBA总决赛：湖人vs凯尔特人
4. 💰 币圈风云：FTX崩盘始末
5. 🗳️ 2024美国大选：特朗普vs拜登
6. 💎 硅谷大佬：马斯克与特朗普联盟
7. 🔬 中美科技战：芯片封锁
8. 🤖 OpenAI宫斗：奥特曼被罢免48小时
9. ⚔️ 俄乌战争：瓦格纳叛乱
10. 🌟 娱乐圈风暴：顶流明星塌房事件
11. 🏢 继承者们：办公室权力游戏

每个剧情包含5个完整的NPC角色，共55个角色。

---

## 🛠️ 技术栈

- **后端**：Node.js + Express.js
- **数据库**：better-sqlite3
- **前端**：原生HTML + CSS + JavaScript
- **端口**：5001（默认）

---

## 📖 快速开始

### 安装依赖
```bash
npm install
```

### 启动服务
```bash
npm start
```

### 访问应用
```
http://localhost:5001
```

### 加载预设剧情
```bash
npm run seed        # 加载所有11个剧情
npm run seed:office # 只加载办公室剧情
```

### 数据库迁移
```bash
npm run migrate     # 更新数据库结构
```

---

## 🔄 与主应用集成

### 导出流程
1. 在Chat-API中创建剧情和NPC
2. 点击"导出"按钮，复制JSON
3. 在主应用中导入JSON
4. 自动创建房间和NPC

### API调用
主应用可以直接调用Chat-API的接口获取数据

---

## 📊 数据模型

### Story（剧情）
```javascript
{
  id: string,              // 房间ID（6位大写）
  name: string,            // 剧情名称
  description: string,     // 剧情描述
  event_background: string,// 背景故事
  dialogue_density: number,// 对话密度(1-5)
  avatar: string,          // 头像
  created_at: datetime,    // 创建时间
  updated_at: datetime     // 更新时间
}
```

### NPC（角色）
```javascript
{
  id: integer,            // 自增ID
  story_id: string,       // 所属剧情ID
  name: string,           // 角色名
  age: integer,           // 年龄
  occupation: string,     // 职业
  avatar: string,         // 头像
  profile: string,        // 简介
  personality: string,    // 性格
  skills: string,         // 技能
  habits: string,         // 习惯
  likes: string,          // 喜好
  dislikes: string,       // 厌恶
  background: string,     // 背景
  goals: string,          // 目标
  fears: string,          // 恐惧
  created_at: datetime    // 创建时间
}
```

---

## ✨ 核心优势

1. **独立部署**：不依赖主应用，可单独运行
2. **数据丰富**：每个NPC 10项详细属性
3. **预设精品**：11个高质量剧情开箱即用
4. **易于扩展**：RESTful API支持二次开发
5. **可视化操作**：友好的Web界面
6. **数据导出**：方便迁移和备份

---

## 🎯 未来规划

- [ ] 支持更多导出格式（CSV、Excel）
- [ ] 角色关系图谱可视化
- [ ] AI辅助生成NPC属性
- [ ] 多语言支持
- [ ] 云端存储选项
- [ ] 剧情模板市场

---

## 📞 技术支持

- **访问地址**：http://localhost:5001
- **API文档**：查看`README.md`
- **剧情说明**：查看`剧情库总览.md`
- **快速上手**：查看`QUICK-START.md`

