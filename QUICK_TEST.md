# 🚀 朋友圈功能 - 快速测试指南

## ✅ 测试前准备

1. **确保服务已启动**: `http://localhost:3001`
2. **确保已登录**: 使用 `jerry` / `123123` 登录
3. **确保已加入房间**: 需要在一个有NPC的房间内

---

## 🧪 快速测试流程（5分钟）

### Step 1: 初始化数据表 (30秒)

访问测试页面：
```
http://localhost:3001/test-moments.html
```

点击 **「🚀 初始化数据表」** 按钮

✅ 期望结果：
```json
{
  "success": true,
  "message": "朋友圈数据表初始化成功"
}
```

---

### Step 2: 测试创建朋友圈 (30秒)

在测试页面：
1. 确认房间ID：`ROOM123`（或你的实际房间ID）
2. 确认用户ID：`1`（或你的实际用户ID）
3. 输入内容：`今天天气真好！☀️`
4. 点击 **「📝 发布朋友圈」**

✅ 期望结果：返回 `momentId`

---

### Step 3: 查看朋友圈列表 (30秒)

在测试页面：
1. 输入房间ID
2. 点击 **「📋 获取列表」**

✅ 期望结果：看到刚才发布的朋友圈

---

### Step 4: 测试AI生成 (1分钟)

⚠️ **前提**: 房间内必须有NPC

在测试页面：
1. 输入房间ID
2. 输入NPC ID（通常是 `1`）
3. 点击 **「🤖 AI生成朋友圈」**

✅ 期望结果：
- 返回成功
- AI生成的内容符合NPC人设
- 刷新列表可以看到新朋友圈

---

### Step 5: 测试点赞 (30秒)

在测试页面：
1. 输入朋友圈ID（上面创建的）
2. 输入用户ID
3. 点击 **「❤️ 点赞/取消」**

✅ 期望结果：
- 第一次点击：`"liked": true`
- 第二次点击：`"liked": false`

---

### Step 6: 测试评论 (30秒)

在测试页面：
1. 输入朋友圈ID
2. 输入用户ID
3. 输入评论：`确实是个好天气！`
4. 点击 **「💬 发表评论」**

✅ 期望结果：返回 `commentId`

---

### Step 7: 测试前端页面 (2分钟)

#### 方法1: 从聊天室进入

1. 访问: `http://localhost:3001`
2. 登录（jerry / 123123）
3. 进入任意房间
4. 点击顶部的 **「🎭 朋友圈」** 按钮

#### 方法2: 直接访问

```
http://localhost:3001/room/ROOM123/moments
```

✅ 检查项：
- [ ] 页面正常加载
- [ ] 显示朋友圈列表
- [ ] 点击 **「➕ 发布」** 可以发布新朋友圈
- [ ] 可以点赞、评论
- [ ] 返回聊天室后，朋友圈按钮显示未读红点（如果有新朋友圈）

---

## 🤖 AI功能测试（高级）

### Test 1: NPC自动评论玩家朋友圈

1. 玩家发布朋友圈
2. 等待3-12秒
3. 刷新朋友圈列表
4. **期望**: 房间内部分NPC已自动评论

### Test 2: AI生成评论

在测试页面或使用curl:
```bash
curl -X POST http://localhost:3001/api/moments/ai-comment \
  -H "Content-Type: application/json" \
  -d '{
    "moment_id": 1,
    "npc_id": 2
  }'
```

**期望**: NPC生成符合人设的评论

---

## 🐛 常见问题排查

### Q1: 初始化失败

**现象**: 点击初始化按钮没有反应或报错

**解决**:
```bash
# 检查数据库文件
ls -la /Users/QRF/Desktop/AI-news/data/chat.db

# 检查服务日志
tail -f /tmp/nuxt-moments.log
```

---

### Q2: AI生成失败

**现象**: AI生成返回错误 `DeepSeek API密钥未配置`

**解决**:
```bash
# 检查.env文件
cat /Users/QRF/Desktop/AI-news/.env | grep DEEPSEEK_API_KEY

# 确保API密钥正确
```

---

### Q3: 朋友圈页面404

**现象**: 访问朋友圈页面返回404

**解决**:
1. 确认URL格式：`/room/[roomId]/moments`
2. 确认房间ID是否存在
3. 重启服务：`npm run dev`

---

### Q4: 未读红点不显示

**现象**: 朋友圈按钮没有显示未读数量

**解决**:
1. 确保已登录
2. 确保房间内有新朋友圈
3. 等待30秒（自动刷新间隔）
4. 检查浏览器Console是否有错误

---

## 📊 测试数据示例

### 创建测试房间和NPC

如果没有测试数据，可以：

1. 访问：`http://localhost:3001`
2. 点击 **「➕ 创建群聊」**
3. 或加入预设房间（王宝强事件、特朗普vs拜登等）

---

## ✅ 测试完成检查清单

### 基础功能
- [ ] 数据表初始化成功
- [ ] 玩家可以发布朋友圈
- [ ] 可以查看朋友圈列表
- [ ] 点赞功能正常
- [ ] 评论功能正常
- [ ] 未读数量显示正常
- [ ] 标记已读功能正常

### AI功能
- [ ] AI可以生成朋友圈
- [ ] 生成内容符合NPC人设
- [ ] AI可以生成评论
- [ ] NPC自动评论玩家朋友圈

### 前端页面
- [ ] 朋友圈列表页正常显示
- [ ] 发布功能正常
- [ ] 点赞交互流畅
- [ ] 评论交互流畅
- [ ] 从聊天室跳转正常
- [ ] 未读红点显示正常

### 集成测试
- [ ] 房间隔离功能正常（不同房间互不干扰）
- [ ] 多用户场景正常
- [ ] AI生成延迟合理
- [ ] 页面性能良好

---

## 🚀 测试通过后的下一步

如果所有测试通过：

1. **提交代码**:
```bash
cd /Users/QRF/Desktop/AI-news
git add .
git commit -m "feat: 完成朋友圈功能"
git push
```

2. **部署到Railway**:
```bash
# Railway会自动检测到新的代码并重新部署
# 或手动触发部署
railway up
```

3. **验证线上环境**:
- 访问Railway提供的URL
- 重复上述测试流程
- 确保所有功能正常

---

**祝测试顺利！🎉**

有问题随时告诉我！

